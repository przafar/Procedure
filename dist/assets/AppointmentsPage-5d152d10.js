import{d as R}from"./index-c49ec32f.js";import{u as j}from"./useModal-31808534.js";import{u as F}from"./index-b32e6f5a.js";import{d as I,X as L,e as B,f as m,a as N,c as A,h as o,w as v,b as u,t as U,s as Y,u as b,Y as q,F as M,_ as Z,r as x,C as D,g as G,i as z,$ as J,o as Q,a1 as W}from"./index-d0dba67e.js";import{u as K}from"./useForm-18fd503d.js";import{p as X,h as ee}from"./moment-7faabd50.js";import{v as S}from"./utils-b2fc192b.js";import{a as ae,u as te,r as le}from"./users-cfbeada4.js";import{a as ne}from"./appointment-aa586bdf.js";import{u as se}from"./useToast-e2130e64.js";import"./users-db-c5bad630.js";const oe={class:"flex items-center gap-2 max-w-[230px] ellipsis"},re={class:"ellipsis max-w-[300px] lg:max-w-[450px]"},ie={class:"flex gap-2 justify-end"},ue={class:"pagination-container mt-4"},de={class:"pagination-controls"},me={class:"total-count"},pe=I({__name:"AppointmentsTable",props:{users:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["edit-user","delete-user","update:sortBy","update:sortingOrder"],setup(i,{emit:d}){const h=R([{label:"Qabul vaqti",key:"created_at",sortable:!1},{label:"F.I.O",key:"patient.full_name",sortable:!0},{label:"Yo`nalishi",key:"encounter_class.display",sortable:!0},{label:"Turi",key:"encounter_type.display",sortable:!0},{label:"Izoh",key:"reason_text",sortable:!0},{label:"Holat",key:"status",sortable:!0},{label:" ",key:"actions",align:"right"}]),p=i,f=d,n=L(p,"users"),y=F(p,"sortBy",f),c=F(p,"sortingOrder",f),r={admin:"danger",user:"background-element",owner:"warning"};B(()=>Math.ceil(p.pagination.total/p.pagination.perPage));const{confirm:w}=j(),g=async e=>{await w({title:"Delete user",message:`Are you sure you want to delete ${e.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&f("delete-user",e)},$=e=>{const l=new Date(e),V={timeZone:"Asia/Tashkent",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return l.toLocaleString("en-GB",V).replace(",","")},t=e=>(e=e||[],e.length===0?"Hujjati yo`q":e.length<=2?e.map(l=>l.value).join(", "):e.slice(0,2).map(l=>l).join(", ")+" + "+(e.length-2)+" K`op");return(e,l)=>{const V=m("VaBadge"),s=m("VaButton"),_=m("router-link"),k=m("VaDataTable"),T=m("VaPagination");return N(),A(M,null,[o(k,{"sort-by":b(y),"onUpdate:sortBy":l[0]||(l[0]=a=>q(y)?y.value=a:null),"sorting-order":b(c),"onUpdate:sortingOrder":l[1]||(l[1]=a=>q(c)?c.value=a:null),columns:b(h),items:n.value,loading:e.$props.loading},{"cell(created_at)":v(({rowData:a})=>[u("div",oe,U($(a.created_at)),1)]),"cell(status)":v(({rowData:a})=>[u("div",{class:Y([["px-2 py-1 rounded text-white",a.status==="in-progress"?"bg-gray-400":"",a.status==="finished"?"bg-green-500":"",a.status==="draft"?"bg-gray-500":"",a.status==="entered-in-error"?"bg-red-500":""],"max-w-[120px] text-center"])},U(a.status),3)]),"cell(role)":v(({rowData:a})=>[o(V,{text:a.role,color:r[a.role]},null,8,["text","color"])]),"cell(identifier)":v(({rowData:a})=>[u("div",re,U(t(a.identifier)),1)]),"cell(actions)":v(({rowData:a})=>[u("div",ie,[o(_,{to:{name:"appointment-show",params:{id:a.id}}},{default:v(()=>[o(s,{preset:"primary",size:"small",icon:"mso-visibility","aria-label":"View appointment"})]),_:2},1032,["to"]),o(s,{preset:"primary",size:"small",disabled:"",icon:"mso-delete",color:"danger","aria-label":"Delete appointment",onClick:E=>g(a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),u("div",ue,[u("div",de,[o(s,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous Page",class:"rounded",rounded:"",gapped:"",disabled:i.pagination.current_page===1,onClick:l[2]||(l[2]=a=>e.$emit("update:current_page",i.pagination.current_page-1))},null,8,["disabled"]),o(T,{modelValue:i.pagination.current_page,"onUpdate:modelValue":[l[3]||(l[3]=a=>i.pagination.current_page=a),l[4]||(l[4]=a=>e.$emit("update:current_page",i.pagination.current_page))],pages:i.pagination.total_pages,"visible-pages":i.pagination.total_pages,"active-page-color":"#154EC1","buttons-preset":"secondary"},null,8,["modelValue","pages","visible-pages"]),o(s,{preset:"secondary",icon:"va-arrow-right","aria-label":"Next Page","buttons-preset":"secondary",rounded:"",gapped:"",disabled:i.pagination.current_page===i.pagination.total_pages,onClick:l[5]||(l[5]=a=>e.$emit("update:current_page",i.pagination.current_page+1))},null,8,["disabled"])]),u("div",me,[u("span",null,"Общее количество: "+U(i.pagination.total),1)])])],64)}}});const ce=Z(pe,[["__scopeId","data-v-ae6a663f"]]),ge={class:"self-stretch flex-col justify-start items-start gap-4 flex"},fe={class:"flex gap-4 flex-col sm:flex-row w-full"},ve={class:"flex gap-4 flex-col sm:flex-row w-full"},_e={class:"flex gap-4 w-full"},be={class:"w-1/2"},ye={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},Ve=I({__name:"EditUserForm",props:{user:{type:Object,default:null},saveButtonLabel:{type:String,default:"Saqlash"}},emits:["close","save"],setup(i,{expose:d,emit:h}){const p=i,f={lastname:"",firstname:"",middlename:"",nnuzb:"",ppn:"",phone:"",birthdate:null,url:"",gender:"men"},n=x({...f}),y=X(),c=B(()=>Object.keys(n.value).some(t=>{var e;return t==="avatar"||t==="projects"?!1:n.value[t]!==((e=p.user??f)==null?void 0:e[t])}));d({isFormHasUnsavedChanges:c}),D(()=>p.user,t=>{var e,l;t?n.value={lastname:t.last_name||"",firstname:t.first_name||"",middlename:t.middle_name||"",nnuzb:((e=t.identifier.find(V=>V.code==="NNUZB"))==null?void 0:e.value)||"",ppn:((l=t.identifier.find(V=>V.code==="PPN"))==null?void 0:l.value)||"",phone:t.phone_number||"",birthdate:t.birth_date||null,url:t.url||"",gender:t.gender||"men"}:n.value={...f}},{immediate:!0});const r=K("add-user-form"),w=h,g=async()=>{if(r.validate()){const t={lastName:n.value.lastname,firstName:n.value.firstname,middleName:n.value.middlename,identifier:[{id:1,code:"PPN",value:n.value.ppn,system:"http://fhir.ssv.uz/ValueSet/identifier-type",display:"Серия и номер паспорта",parent_id:null},{id:2,code:"NNUZB",value:n.value.nnuzb,system:"http://fhir.ssv.uz/ValueSet/identifier-type",display:"Идентификационный номер гражданина в Республике Узбекистан (ПИНФЛ)",parent_id:null}],phoneNumber:n.value.phone,url:n.value.url,gender:n.value.gender==="men"?"male":"female",birthDate:ee(n.value.birthdate).format("YYYY-MM-DDTHH:mm:ssZ")};try{p.user?await y.UPDATE_PATIENT(t,p.user.id).then(async e=>{if(e.status===200){const l=await e.data;w("save",l)}else console.error("Failed to save user data:",e)}):await y.CREATE_PATIENT(t).then(async e=>{if(e.status===201){const l=await e.data;w("save",l)}else console.error("Failed to save user data:",e)})}catch(e){console.error("Error during request:",e)}}},$=[{text:"Erkak",value:"men"},{text:"Ayol",value:"female"}];return(t,e)=>{const l=m("VaInput"),V=m("VaSelect"),s=m("VaDateInput"),_=m("VaButton"),k=m("VaForm");return N(),G(k,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:v(({isValid:T})=>[u("div",ge,[u("div",fe,[o(l,{modelValue:n.value.lastname,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.lastname=a),label:"Familiya",class:"w-full sm:w-1/2",rules:[b(S).required],name:"lastname"},null,8,["modelValue","rules"]),o(l,{modelValue:n.value.firstname,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.firstname=a),label:"Ism",class:"w-full sm:w-1/2",rules:[b(S).required],name:"firstname"},null,8,["modelValue","rules"]),o(l,{modelValue:n.value.middlename,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.middlename=a),label:"Otasining ismi",class:"w-full sm:w-1/2",name:"middlename"},null,8,["modelValue"])]),u("div",ve,[o(l,{modelValue:n.value.nnuzb,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.nnuzb=a),label:"JSHSHR (Pinfl)",class:"w-full sm:w-1/2",name:"nnuzb"},null,8,["modelValue"]),o(l,{modelValue:n.value.ppn,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.ppn=a),label:"Passport",class:"w-full sm:w-1/2",name:"ppn"},null,8,["modelValue"])]),u("div",_e,[u("div",be,[o(V,{modelValue:n.value.gender,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.gender=a),label:"Jinsi",class:"w-full",options:$,rules:[b(S).required],name:"gender","value-by":"value"},null,8,["modelValue","rules"])]),o(s,{modelValue:n.value.birthdate,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.birthdate=a),label:"Tug'ilgan sanasi",class:"w-full",name:"birthdate","manual-input":""},null,8,["modelValue"])]),o(l,{modelValue:n.value.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.phone=a),label:"Telefon raqami",class:"w-full sm:w-1/2",name:"phone"},null,8,["modelValue"]),u("div",ye,[o(_,{preset:"secondary",color:"secondary",onClick:e[8]||(e[8]=a=>t.$emit("close"))},{default:v(()=>[z("Bekor qilish")]),_:1}),o(_,{disabled:!T,onClick:g},{default:v(()=>[z(U(i.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]),_:1},512)}}}),he=()=>x({current_page:1,per_page:10,total:0,total_pages:0}),we=()=>x({search:""}),xe=i=>{const d=x(!1),h=x([]),p=ne(),f=J(),n=B(()=>f.path),y=B(()=>f.query),{filters:c=we(),pagination:r=he()}=i||{},w=()=>{const t=y.value;r.value.current_page=t.page?parseInt(t.page,10):1,r.value.per_page=t.per_page?parseInt(t.per_page,10):10,c.value.search=t.search?t.search:""},g=async()=>{const t={page:r.value.current_page,per_page:r.value.per_page,search:c.value.search};await $(t)},$=async t=>{d.value=!0,W.push({path:n.value,query:t});try{const{data:e}=await p.GET_LIST_OF_APPOINTMENTS(t);h.value=e.data,r.value.total=e.pagination.total,r.value.per_page=e.pagination.per_page,r.value.current_page=e.pagination.current_page,r.value.total_pages=e.pagination.total_pages}catch(e){console.error("Error fetching data:",e)}finally{d.value=!1}};return Q(()=>{w(),g()}),D([r,c],g,{deep:!0}),{isLoading:d,filters:c,pagination:r,users:h,fetch:g,async add(t){d.value=!0,await ae(t),await g(),d.value=!1},async update(t){d.value=!0,await te(t),await g(),d.value=!1},async remove(t){d.value=!0,await le(t),await g(),d.value=!1}}},$e={class:"page-title"},Ce={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Ue={class:"flex flex-col md:flex-row gap-2 justify-start"},ke={class:"va-h5"},Me=I({__name:"AppointmentsPage",setup(i){const d=x(!1),{users:h,isLoading:p,filters:f,sorting:n,pagination:y,...c}=xe(),r=x(null),w=s=>{console.log(s,"user"),r.value=s,d.value=!0},{init:g}=se(),$=async s=>{r.value?(await c.update(s),console.log(s,"user"),g({message:`${s.fullname} ${$t("hasBeenUpdated")}`,color:"success"})):(c.add(s),g({message:`${s.fullname} ${$t("hasBeenCreated")}`,color:"success"}))},t=async s=>{await c.remove(s),g({message:`${s.fullname} ${$t("hasBeenDeleted")}`,color:"success"})},e=x(),{confirm:l}=j(),V=async s=>{e.value.isFormHasUnsavedChanges?await l({maxWidth:"380px",message:$t("formHasUnsavedChanges"),size:"small"})&&s():s()};return(s,_)=>{const k=m("VaIcon"),T=m("VaInput"),a=m("VaCardContent"),E=m("VaCard"),O=m("VaModal");return N(),A(M,null,[u("h1",$e,U(s.$t("appointment")),1),o(E,null,{default:v(()=>[o(a,null,{default:v(()=>[u("div",Ce,[u("div",Ue,[o(T,{modelValue:b(f).search,"onUpdate:modelValue":_[0]||(_[0]=C=>b(f).search=C),placeholder:s.$t("search")},{prependInner:v(()=>[o(k,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue","placeholder"])])]),o(ce,{users:b(h),loading:b(p),pagination:b(y),"onUpdate:current_page":_[1]||(_[1]=C=>{b(y).current_page=C,s.fetchUsers()}),onEditUser:w,onDeleteUser:t},null,8,["users","loading","pagination"])]),_:1})]),_:1}),o(O,{modelValue:d.value,"onUpdate:modelValue":_[2]||(_[2]=C=>d.value=C),size:"large","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":V},{default:v(({cancel:C,ok:P})=>[u("h1",ke,U(r.value?s.$t("edit"):s.$t("addPatient")),1),o(Ve,{ref_key:"editFormRef",ref:e,user:r.value,"save-button-label":r.value?s.$t("save"):s.$t("add"),onClose:C,onSave:H=>{$(H),P()}},null,8,["user","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Me as default};
//# sourceMappingURL=AppointmentsPage-5d152d10.js.map
