import{d as q,I as X,X as J,e as F,r as $,f as b,a as I,c as z,h as s,w as y,b as r,t as C,u as U,F as A,_ as K,C as M,g as ee,i as T,Z as R,$ as j,o as O}from"./index-d0dba67e.js";import{d as ae}from"./index-c49ec32f.js";import{u as le}from"./useModal-31808534.js";import{u as P}from"./index-b32e6f5a.js";import{u as te}from"./useForm-18fd503d.js";import{p as L,h as ne}from"./moment-7faabd50.js";import{v as B}from"./utils-b2fc192b.js";import{u as se}from"./useToast-e2130e64.js";const oe={class:"flex items-center gap-2 max-w-[230px] ellipsis"},ue={class:"ellipsis max-w-[300px] lg:max-w-[450px]"},re={class:"flex gap-2 justify-end"},ie={class:"pagination-container mt-4"},de={class:"pagination-controls"},me={class:"total-count"},pe=q({__name:"PatientsTable",props:{users:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["edit-user","delete-user","update:sortBy","update:sortingOrder"],setup(d,{emit:_}){const{t:u}=X(),m=ae([{label:u("ID"),key:"id",sortable:!1},{label:u("fullName"),key:"full_name",sortable:!0},{label:u("identityDocument"),key:"identifier",sortable:!0},{label:u("birthYear"),key:"birth_date",sortable:!0},{label:u("phoneNumber"),key:"phone_number",sortable:!0},{label:" ",key:"actions",align:"right"}]),g=d,l=_,p=J(g,"users");P(g,"sortBy",l),P(g,"sortingOrder",l),F(()=>Math.ceil(g.pagination.total/g.pagination.perPage));const{confirm:c}=le();$(5);const w=async t=>{await c({title:u("Delete user"),message:u("Are you sure you want to delete {name}?",{name:t.fullname}),okText:u("Delete"),cancelText:u("Cancel"),size:"small",maxWidth:"380px"})&&l("delete-user",t)},v=t=>(t=Array.isArray(t)?t:[],t.length===0?u("noDocument"):t.length<=2?t.map(o=>o.value).join(", "):t.slice(0,2).map(o=>o.value).join(", ")+" + "+(t.length-2)+u(" more"));return(t,o)=>{const e=b("VaButton"),n=b("VaDataTable"),f=b("VaPagination");return I(),z(A,null,[s(n,{columns:U(m),items:p.value,loading:t.$props.loading},{"cell(fullname)":y(({rowData:i})=>[r("div",oe,C(i.id),1)]),"cell(identifier)":y(({rowData:i})=>[r("div",ue,C(v(i.identifier)),1)]),"cell(actions)":y(({rowData:i})=>[r("div",re,[s(e,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit user",onClick:S=>t.$emit("edit-user",i)},null,8,["onClick"]),s(e,{preset:"primary",size:"small",icon:"mso-delete",color:"danger",onClick:S=>w(i)},null,8,["onClick"])])]),_:1},8,["columns","items","loading"]),r("div",ie,[r("div",de,[s(e,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous Page",class:"rounded",rounded:"",gapped:"",disabled:d.pagination.current_page===1,onClick:o[0]||(o[0]=i=>t.$emit("update:current_page",d.pagination.current_page-1))},null,8,["disabled"]),s(f,{modelValue:d.pagination.current_page,"onUpdate:modelValue":[o[1]||(o[1]=i=>d.pagination.current_page=i),o[2]||(o[2]=i=>t.$emit("update:current_page",d.pagination.current_page))],pages:d.pagination.total_pages,"visible-pages":d.pagination.total_pages,"active-page-color":"#154EC1","buttons-preset":"secondary"},null,8,["modelValue","pages","visible-pages"]),s(e,{preset:"secondary",icon:"va-arrow-right","aria-label":"Next Page","buttons-preset":"secondary",rounded:"",gapped:"",disabled:d.pagination.current_page===d.pagination.total_pages,onClick:o[3]||(o[3]=i=>t.$emit("update:current_page",d.pagination.current_page+1))},null,8,["disabled"])]),r("div",me,[r("span",null,"Общее количество: "+C(d.pagination.total),1)])])],64)}}});const ce=K(pe,[["__scopeId","data-v-f8003fb0"]]),fe={class:"self-stretch flex-col justify-start items-start gap-4 flex"},ve={class:"flex gap-4 flex-col sm:flex-row w-full"},ge={class:"flex gap-4 flex-col sm:flex-row w-full"},be={class:"flex gap-4 w-full"},Ve={class:"w-1/2"},ye={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},_e=q({__name:"EditUserForm",props:{user:{type:Object,default:null},saveButtonLabel:{type:String,default:"Saqlash"}},emits:["close","save"],setup(d,{expose:_,emit:u}){const m=d,g={lastname:"",firstname:"",middlename:"",nnuzb:"",ppn:"",phone:"",birthdate:null,url:"",gender:"men"},l=$({...g}),p=L(),c=F(()=>Object.keys(l.value).some(e=>{var n;return e==="avatar"||e==="projects"?!1:l.value[e]!==((n=m.user??g)==null?void 0:n[e])}));_({isFormHasUnsavedChanges:c}),M(()=>m.user,e=>{var n,f;e?l.value={lastname:e.last_name||"",firstname:e.first_name||"",middlename:e.middle_name||"",nnuzb:((n=e.identifier.find(i=>i.code==="NNUZB"))==null?void 0:n.value)||"",ppn:((f=e.identifier.find(i=>i.code==="PPN"))==null?void 0:f.value)||"",phone:e.phone_number||"",birthdate:e.birth_date||null,url:e.url||"",gender:e.gender||"men"}:l.value={...g}},{immediate:!0});const w=te("add-user-form"),v=u,t=async()=>{if(w.validate()){const e={lastName:l.value.lastname,firstName:l.value.firstname,middleName:l.value.middlename,identifier:[{id:1,code:"PPN",value:l.value.ppn,system:"http://fhir.ssv.uz/ValueSet/identifier-type",display:"Серия и номер паспорта",parent_id:null},{id:2,code:"NNUZB",value:l.value.nnuzb,system:"http://fhir.ssv.uz/ValueSet/identifier-type",display:"Идентификационный номер гражданина в Республике Узбекистан (ПИНФЛ)",parent_id:null}],phoneNumber:l.value.phone,url:l.value.url,gender:l.value.gender==="men"?"male":"female",birthDate:ne(l.value.birthdate).format("YYYY-MM-DDTHH:mm:ssZ")};try{m.user?await p.UPDATE_PATIENT(e,m.user.id).then(async n=>{if(n.status===200){const f=await n.data;v("save",f)}else console.error("Failed to save user data:",n)}):await p.CREATE_PATIENT(e).then(async n=>{if(n.status===201){const f=await n.data;v("save",f)}else console.error("Failed to save user data:",n)})}catch(n){console.error("Error during request:",n)}}},o=[{text:"Erkak",value:"men"},{text:"Ayol",value:"female"}];return(e,n)=>{const f=b("VaInput"),i=b("VaSelect"),S=b("VaDateInput"),E=b("VaButton"),k=b("VaForm");return I(),ee(k,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:y(({isValid:D})=>[r("div",fe,[r("div",ve,[s(f,{modelValue:l.value.lastname,"onUpdate:modelValue":n[0]||(n[0]=a=>l.value.lastname=a),label:e.$t("lastname"),class:"w-full sm:w-1/2",rules:[U(B).required],name:"lastname"},null,8,["modelValue","label","rules"]),s(f,{modelValue:l.value.firstname,"onUpdate:modelValue":n[1]||(n[1]=a=>l.value.firstname=a),label:e.$t("firstname"),class:"w-full sm:w-1/2",rules:[U(B).required],name:"firstname"},null,8,["modelValue","label","rules"]),s(f,{modelValue:l.value.middlename,"onUpdate:modelValue":n[2]||(n[2]=a=>l.value.middlename=a),label:e.$t("middlename"),class:"w-full sm:w-1/2",name:"middlename"},null,8,["modelValue","label"])]),r("div",ge,[s(f,{modelValue:l.value.nnuzb,"onUpdate:modelValue":n[3]||(n[3]=a=>l.value.nnuzb=a),label:e.$t("pinfl"),class:"w-full sm:w-1/2",name:"nnuzb"},null,8,["modelValue","label"]),s(f,{modelValue:l.value.ppn,"onUpdate:modelValue":n[4]||(n[4]=a=>l.value.ppn=a),label:e.$t("passport"),class:"w-full sm:w-1/2",name:"ppn"},null,8,["modelValue","label"])]),r("div",be,[r("div",Ve,[s(i,{modelValue:l.value.gender,"onUpdate:modelValue":n[5]||(n[5]=a=>l.value.gender=a),label:e.$t("gender"),class:"w-full",options:o,rules:[U(B).required],name:"gender","value-by":"value"},null,8,["modelValue","label","rules"])]),s(S,{modelValue:l.value.birthdate,"onUpdate:modelValue":n[6]||(n[6]=a=>l.value.birthdate=a),label:e.$t("birthDate"),class:"w-full",name:"birthdate","manual-input":""},null,8,["modelValue","label"])]),s(f,{modelValue:l.value.phone,"onUpdate:modelValue":n[7]||(n[7]=a=>l.value.phone=a),label:e.$t("phoneNumber"),class:"w-full sm:w-1/2",name:"phone"},null,8,["modelValue","label"]),r("div",ye,[s(E,{preset:"secondary",color:"secondary",onClick:n[8]||(n[8]=a=>e.$emit("close"))},{default:y(()=>[T(C(e.$t("cancel")),1)]),_:1}),s(E,{disabled:!D,onClick:t},{default:y(()=>[T(C(d.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]),_:1},512)}}}),he=()=>$({current_page:1,per_page:10,total:0,total_pages:0}),we=()=>$({firstname:"",lastname:"",middlename:"",gender:null}),$e=d=>{const _=R(),u=j(),m=$(!1),g=$([]),l=L(),{filters:p=we(),pagination:c=he()}=d||{},w=()=>{const t=u.query;c.value.current_page=t.page?parseInt(t.page,10):1,c.value.per_page=t.per_page?parseInt(t.per_page,10):10,p.value.firstname=t.firstname?t.firstname:"",p.value.lastname=t.lastname?t.lastname:"",p.value.middlename=t.middlename?t.middlename:"",p.value.gender=t.gender?t.gender:null},v=async()=>{const t={page:c.value.current_page,per_page:c.value.per_page,firstname:p.value.firstname,lastname:p.value.lastname,middlename:p.value.middlename,gender:p.value.gender};m.value=!0;try{_.push({path:u.path,query:t});const{data:o}=await l.GET_LIST_OF_PATIENTS(t);g.value=o.data,c.value.total=o.pagination.total,c.value.total_pages=o.pagination.total_pages}catch(o){console.error("Error fetching users:",o)}finally{m.value=!1}};return O(()=>{w(),v()}),M([p,c],v,{deep:!0}),{isLoading:m,filters:p,pagination:c,users:g,fetch:v,async add(t){m.value=!0;try{await l.ADD_USER(t),await v()}finally{m.value=!1}},async update(t){m.value=!0;try{await l.UPDATE_USER(t),await v()}finally{m.value=!1}},async remove(t){m.value=!0;try{await l.REMOVE_USER(t),await v()}finally{m.value=!1}}}},Ce={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between mb-4"},Ue={class:"grid gap-4 grid-cols-4 mb-4"},Se={class:"w-full"},Ee={class:"w-full"},Te={class:"w-full"},ke={class:"va-h5"},ze=q({__name:"PatientsPage",setup(d){const _=$(!1),u=$(null),{users:m,isLoading:g,filters:l,pagination:p,fetch:c,...w}=$e(),{init:v}=se(),t=R(),o=j(),e=$({firstname:"",lastname:"",middlename:"",gender:null}),n=()=>{const a=o.query;e.value.firstname=a.firstname||"",e.value.lastname=a.lastname||"",e.value.middlename=a.middlename||"",e.value.gender=a.gender||null},f=()=>{l.value.firstname=e.value.firstname,l.value.lastname=e.value.lastname,l.value.middlename=e.value.middlename,l.value.gender=e.value.gender,t.push({query:{...o.query,firstname:e.value.firstname||void 0,lastname:e.value.lastname||void 0,middlename:e.value.middlename||void 0,gender:e.value.gender||void 0}}),c()};O(()=>{n()});const i=a=>{p.current_page=a,c()},S=a=>{u.value=a,_.value=!0},E=()=>{u.value=null,_.value=!0},k=async a=>{u.value?(await w.update(a),v({message:`${a.fullname} has been updated`,color:"success"})):(await w.add(a),v({message:`${a.fullname} has been created`,color:"success"})),c()},D=async a=>{await w.remove(a),v({message:`${a.fullname} has been deleted`,color:"success"}),c()};return(a,h)=>{const x=b("VaButton"),N=b("VaInput"),Y=b("VaSelect"),Z=b("VaCardContent"),H=b("VaCard"),Q=b("VaModal");return I(),z(A,null,[r("div",Ce,[s(x,{onClick:E},{default:y(()=>[T(C(a.$t("addPatient")),1)]),_:1})]),s(H,null,{default:y(()=>[s(Z,null,{default:y(()=>[r("div",Ue,[r("div",Se,[s(N,{modelValue:e.value.lastname,"onUpdate:modelValue":h[0]||(h[0]=V=>e.value.lastname=V),label:a.$t("lastname"),placeholder:a.$t("lastname")},null,8,["modelValue","label","placeholder"])]),r("div",Ee,[s(N,{modelValue:e.value.firstname,"onUpdate:modelValue":h[1]||(h[1]=V=>e.value.firstname=V),label:a.$t("firstname"),placeholder:a.$t("firstname")},null,8,["modelValue","label","placeholder"])]),r("div",Te,[s(N,{modelValue:e.value.middlename,"onUpdate:modelValue":h[2]||(h[2]=V=>e.value.middlename=V),label:a.$t("middlename"),placeholder:a.$t("middlename")},null,8,["modelValue","label","placeholder"])]),r("div",null,[s(Y,{modelValue:e.value.gender,"onUpdate:modelValue":h[3]||(h[3]=V=>e.value.gender=V),label:a.$t("gender"),class:"w-full",options:a.roleSelectOptions,name:"gender","value-by":"value"},null,8,["modelValue","label","options"])]),r("div",null,[s(x,{color:"warning",onClick:f},{default:y(()=>[T(C(a.$t("filter")),1)]),_:1})])]),s(ce,{users:U(m),loading:U(g),pagination:U(p),"onUpdate:current_page":i,onEditUser:S,onDeleteUser:D},null,8,["users","loading","pagination"])]),_:1})]),_:1}),s(Q,{modelValue:_.value,"onUpdate:modelValue":h[4]||(h[4]=V=>_.value=V),size:"large","mobile-fullscreen":"","close-button":"","hide-default-actions":""},{default:y(({cancel:V,ok:G})=>[r("h1",ke,C(u.value?"Tahrirlash":"Bemor qo`shish"),1),s(_e,{ref:"editFormRef",user:u.value,"save-button-label":u.value?"Saqlash":"Qo`shish",onClose:V,onSave:W=>{k(W),G()}},null,8,["user","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{ze as default};
//# sourceMappingURL=PatientsPage-3b63f60a.js.map
