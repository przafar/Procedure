import{d as R,w as Z}from"./index-c49ec32f.js";import{u as N}from"./useModal-31808534.js";import{d as I,f as _,a as O,g as z,w as u,b as n,t as $,h as l,u as p,_ as L,r as w,c as P,i as E,F as W,p as ee,m as se,e as te,C as G}from"./index-d0dba67e.js";import{u as H}from"./useForm-18fd503d.js";import{v as B}from"./utils-b2fc192b.js";import{S as j}from"./services-b8050135.js";import{a as ae,r as le}from"./users-cfbeada4.js";import{u as oe}from"./useToast-e2130e64.js";import"./users-db-c5bad630.js";const ne={class:"flex items-center gap-2 max-w-[230px] ellipsis"},re={class:"max-w-[120px] ellipsis"},ie={class:"flex gap-2 justify-end"},de=I({__name:"ServicesTable",props:{encounters:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["edit-user","show-class","delete-user","update:sortBy","update:sortingOrder"],setup(g,{emit:i}){const C=R([{label:"ID",key:"id",sortable:!1},{label:"Code",key:"code",sortable:!0},{label:"Nomi",key:"display",sortable:!0},{label:" ",key:"actions",align:"right"}]),b=i,{confirm:S}=N(),c=async r=>{await S({title:"Delete user",message:`Are you sure you want to delete ${r.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&b("delete-user",r)};return(r,y)=>{const m=_("VaButton"),k=_("VaDataTable");return O(),z(k,{"sort-by":r.sortByVModel,"onUpdate:sortBy":y[0]||(y[0]=t=>r.sortByVModel=t),"sorting-order":r.sortingOrderVModel,"onUpdate:sortingOrder":y[1]||(y[1]=t=>r.sortingOrderVModel=t),columns:p(C),items:g.encounters,loading:r.$props.loading},{"cell(fullname)":u(({rowData:t})=>[n("div",ne,$(t.id),1)]),"cell(username)":u(({rowData:t})=>[n("div",re,$(t.code),1)]),"cell(actions)":u(({rowData:t})=>[n("div",ie,[l(m,{preset:"success",size:"small",icon:"visibility","aria-label":"Edit user",onClick:e=>r.$emit("show-class",t)},null,8,["onClick"]),l(m,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit user",onClick:e=>r.$emit("edit-user",t)},null,8,["onClick"]),l(m,{preset:"primary",size:"small",icon:"mso-delete",color:"danger",disabled:"","aria-label":"Delete user",onClick:e=>c(t)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"])}}});const ue=L(de,[["__scopeId","data-v-d94926ca"]]),ce=g=>(ee("data-v-6cf56969"),g=g(),se(),g),me={class:"flex items-center gap-2 max-w-[230px] ellipsis"},pe={class:"max-w-[120px] ellipsis"},fe={class:"max-w-[120px] ellipsis"},ve={class:"flex gap-2 justify-end"},ye=ce(()=>n("h1",{class:"va-h5"},"Muolaja qo`shish",-1)),_e={class:"self-stretch flex-col justify-start items-start gap-4 flex"},ge={class:"w-full"},be={class:"flex gap-4 flex-col sm:flex-row w-full mb-2"},we={class:"w-full"},he={class:"w-full"},Ve={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},Ce=I({__name:"ShowServiceForm",props:{types:{type:Array,required:!0},classId:{type:Number,required:!0},loading:{type:Boolean,default:!1}},emits:["edit-user","show-class","delete-user","update:sortBy","update:sortingOrder"],setup(g,{emit:i}){const C=R([{label:"ID",key:"id",sortable:!1},{label:"Code",key:"code",sortable:!0},{label:"Nomi",key:"display",sortable:!0},{label:"Summa",key:"price",sortable:!0},{label:" ",key:"actions",align:"right"}]),b=g,S=j(),c=w(!1),r=i,{confirm:y}=N(),m=async d=>{await y({title:"Delete user",message:`Are you sure you want to delete ${d.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&r("delete-user",d)},t=w({...{code:"",text:"",price:0}}),e=H("add-user-form"),s=async()=>{if(e.validate()){const d={code:t.value.code,display:t.value.text,price:t.value.price,class_code:b.classId.id};try{await S.CREATE_ENCOUNTER_TYPES(d).then(async a=>{if(a.status===200){const h=await a.data;r("save",h)}else console.error("Failed to save user data:",a)})}catch(a){console.error("Error during request:",a)}}};return(d,a)=>{const h=_("VaButton"),U=_("VaDataTable"),x=_("VaInput"),T=_("VaForm"),M=_("VaModal");return O(),P(W,null,[n("div",null,[l(h,{preset:"primary",class:"mr-6 mb-2",onClick:a[0]||(a[0]=f=>c.value=!0)},{default:u(()=>[E(" Muolaja qo'shish ")]),_:1})]),l(U,{"sort-by":d.sortByVModel,"onUpdate:sortBy":a[1]||(a[1]=f=>d.sortByVModel=f),"sorting-order":d.sortingOrderVModel,"onUpdate:sortingOrder":a[2]||(a[2]=f=>d.sortingOrderVModel=f),columns:p(C),items:g.types,loading:d.$props.loading},{"cell(fullname)":u(({rowData:f})=>[n("div",me,$(f.id),1)]),"cell(username)":u(({rowData:f})=>[n("div",pe,$(f.code),1)]),"cell(price)":u(({rowData:f})=>[n("div",fe,$(f.price),1)]),"cell(actions)":u(({rowData:f})=>[n("div",ve,[l(h,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit user",onClick:F=>d.$emit("edit-user",f)},null,8,["onClick"]),l(h,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete user",onClick:F=>m(f)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),l(M,{modelValue:c.value,"onUpdate:modelValue":a[7]||(a[7]=f=>c.value=f),size:"large","max-width":"80%","mobile-fullscreen":"","close-button":"","hide-default-actions":""},{default:u(({cancel:f,ok:F})=>[ye,l(T,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:u(({isValid:o})=>[n("div",_e,[n("div",ge,[n("div",be,[l(x,{modelValue:t.value.code,"onUpdate:modelValue":a[3]||(a[3]=v=>t.value.code=v),rules:[p(B).required],label:"Code",class:"w-full",name:"code"},null,8,["modelValue","rules"])]),n("div",we,[l(x,{modelValue:t.value.text,"onUpdate:modelValue":a[4]||(a[4]=v=>t.value.text=v),rules:[p(B).required],label:"Tekst",class:"w-full mt-2",name:"display"},null,8,["modelValue","rules"])]),n("div",he,[l(x,{modelValue:t.value.price,"onUpdate:modelValue":a[5]||(a[5]=v=>t.value.price=v),rules:[p(B).required],label:"Summa",class:"w-full mt-2",name:"display"},null,8,["modelValue","rules"])])]),n("div",Ve,[l(h,{preset:"secondary",color:"secondary",onClick:a[6]||(a[6]=v=>d.$emit("close"))},{default:u(()=>[E("Bekor qilish")]),_:1}),l(h,{disabled:!o,onClick:s},{default:u(()=>[E("Сохранить")]),_:2},1032,["disabled"])])])]),_:1},512)]),_:1},8,["modelValue"])],64)}}});const Se=L(Ce,[["__scopeId","data-v-6cf56969"]]),xe={class:"self-stretch flex-col justify-start items-start gap-4 flex"},$e={class:"w-full"},ke={class:"flex gap-4 flex-col sm:flex-row w-full mb-2"},Ue={class:"w-full"},Ee={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},Te=I({__name:"EditServiceForm",props:{user:{type:Object,default:null},encounters:{type:Array,required:!0},saveButtonLabel:{type:String,default:"Saqlash"}},emits:["close","save"],setup(g,{expose:i,emit:C}){const b=g,S={code:"",text:""},c=w({...S}),r=j(),y=te(()=>Object.keys(c.value).some(e=>{var s;return e==="avatar"||e==="projects"?!1:c.value[e]!==((s=b.user??S)==null?void 0:s[e])}));i({isFormHasUnsavedChanges:y}),G(()=>b.user,e=>{console.log(e,"newUserProps")},{immediate:!0});const m=H("add-user-form"),k=C,t=async()=>{if(m.validate()){const e={code:c.value.code,display:c.value.text};try{b.user?await r.CREATE_ENCOUNTER_CLASSES(e,b.user.id).then(async s=>{if(s.status===200){const d=await s.data;k("save",d)}else console.error("Failed to save user data:",s)}):await r.CREATE_ENCOUNTER_CLASSES(e).then(async s=>{if(s.status===201){const d=await s.data;k("save",d)}else console.error("Failed to save user data:",s)})}catch(s){console.error("Error during request:",s)}}};return(e,s)=>{const d=_("VaInput"),a=_("VaButton"),h=_("VaForm");return O(),z(h,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:u(({isValid:U})=>[n("div",xe,[n("div",$e,[n("div",ke,[l(d,{modelValue:c.value.code,"onUpdate:modelValue":s[0]||(s[0]=x=>c.value.code=x),rules:[p(B).required],label:"Code",class:"w-full",name:"code"},null,8,["modelValue","rules"])]),n("div",Ue,[l(d,{modelValue:c.value.text,"onUpdate:modelValue":s[1]||(s[1]=x=>c.value.text=x),rules:[p(B).required],label:"Tekst",class:"w-full",name:"display"},null,8,["modelValue","rules"])])]),n("div",Ee,[l(a,{preset:"secondary",color:"secondary",onClick:s[2]||(s[2]=x=>e.$emit("close"))},{default:u(()=>[E("Bekor qilish")]),_:1}),l(a,{disabled:!U,onClick:t},{default:u(()=>[E($(g.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]),_:1},512)}}}),Be=()=>w({current_page:1,per_page:10,total:0,total_pages:0}),Fe=()=>w({sortBy:"fullname",sortingOrder:null}),Ie=()=>w({isActive:!0,search:""}),Oe=g=>{const i=w(!1),C=w([]),b=w([]),S=j(),{filters:c=Ie(),sorting:r=Fe(),pagination:y=Be()}=g||{},m=async()=>{i.value=!0;const{data:e}=await S.GET_LIST_OF_ECOUNTER_CLASSES().then(s=>s);C.value=e.data,t(()=>{y.value=e.pagination}),i.value=!1},k=async e=>{i.value=!0;try{await S.GET_LIST_OF_ECOUNTER_TYPES(e.code).then(s=>(b.value=s.data.data,s))}catch(s){console.error("Error fetching children:",s)}finally{i.value=!1}},{ignoreUpdates:t}=Z([y,r],m,{deep:!0});return G(c,()=>{y.value.page=1,m()},{deep:!0}),m(),{isLoading:i,filters:c,sorting:r,pagination:y,encounters:C,fetchChildren:k,fetch:m,types:b,async add(e){i.value=!0,await ae(e),await m(),i.value=!1},async update(e){i.value=!0,await m(),i.value=!1},async remove(e){i.value=!0,await le(e),await m(),i.value=!1}}},Me={class:"page-title"},qe={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},De={class:"flex flex-col md:flex-row gap-2 justify-start"},Ne={class:"va-h5"},je={class:"va-h5"},Qe=I({__name:"ServicesPage",setup(g){const i=w(!1),C=w(!1),{encounters:b,types:S,fetchChildren:c,isLoading:r,filters:y,sorting:m,pagination:k,...t}=Oe(),e=w(null),s=w(null),d=()=>{e.value=null,i.value=!0},a=o=>{s.value=o,C.value=!0,c(o)},{init:h}=oe(),U=async o=>{e.value?(await t.update(o),console.log(o,"user"),h({message:`${o.fullname} has been updated`,color:"success"})):(t.add(o),h({message:`${o.fullname} has been created`,color:"success"}))},x=async o=>{await t.remove(o),h({message:`${o.fullname} has been deleted`,color:"success"})},T=w(),{confirm:M}=N(),f=async o=>{T.value.isFormHasUnsavedChanges?await M({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&o():o()},F=async o=>{await c(o.code)};return(o,v)=>{const Y=_("VaIcon"),Q=_("VaInput"),J=_("VaButton"),K=_("VaCardContent"),X=_("VaCard"),A=_("VaModal");return O(),P(W,null,[n("h1",Me,$(o.$t("services")),1),l(X,null,{default:u(()=>[l(K,null,{default:u(()=>[n("div",qe,[n("div",De,[l(Q,{modelValue:p(y).search,"onUpdate:modelValue":v[0]||(v[0]=V=>p(y).search=V),placeholder:o.$t("search.placeholder")},{prependInner:u(()=>[l(Y,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue","placeholder"])]),l(J,{onClick:d},{default:u(()=>[E($(o.$t("addService")),1)]),_:1})]),l(ue,{"sort-by":p(m).sortBy,"onUpdate:sortBy":v[1]||(v[1]=V=>p(m).sortBy=V),"sorting-order":p(m).sortingOrder,"onUpdate:sortingOrder":v[2]||(v[2]=V=>p(m).sortingOrder=V),encounters:p(b),loading:p(r),pagination:p(k),onShowClass:a,onOpenChild:F,onDeleteUser:x},null,8,["sort-by","sorting-order","encounters","loading","pagination"])]),_:1})]),_:1}),l(A,{modelValue:i.value,"onUpdate:modelValue":v[3]||(v[3]=V=>i.value=V),size:"medium","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":f},{default:u(({cancel:V,ok:q})=>[n("h1",Ne,$(e.value?o.$t("editDirection"):o.$t("addDirection")),1),l(Te,{ref_key:"editFormRef",ref:T,user:e.value,encounters:p(b),"save-button-label":e.value?o.$t("save"):o.$t("add"),onClose:V,onSave:D=>{U(D),q()}},null,8,["user","encounters","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"]),l(A,{modelValue:C.value,"onUpdate:modelValue":v[4]||(v[4]=V=>C.value=V),size:"large","max-width":"80%","mobile-fullscreen":"","close-button":"","hide-default-actions":""},{default:u(({cancel:V,ok:q})=>[n("h1",je,$(s.value.display),1),l(Se,{ref_key:"editFormRef",ref:T,types:p(S),classId:s.value,loading:p(r),"save-button-label":e.value?"Saqlash":"Qo`shish",onClose:V,onSave:D=>{U(D),q()}},null,8,["types","classId","loading","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Qe as default};
//# sourceMappingURL=ServicesPage-ac1ee574.js.map
