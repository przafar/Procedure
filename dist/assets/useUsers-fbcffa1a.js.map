{"version":3,"file":"useUsers-fbcffa1a.js","sources":["../../src/pages/users/composables/useUsers.ts"],"sourcesContent":["import { Ref, ref, unref, watch } from 'vue'\nimport { getUsers, updateUser, addUser, removeUser, type Filters, Pagination, Sorting } from '../../../data/pages/users'\nimport { User } from '../types'\nimport { watchIgnorable } from '@vueuse/core'\n\nconst makePaginationRef = () => ref<Pagination>({ page: 1, perPage: 10, total: 0 })\nconst makeSortingRef = () => ref<Sorting>({ sortBy: 'fullname', sortingOrder: null })\nconst makeFiltersRef = () => ref<Partial<Filters>>({ isActive: true, search: '' })\n\nexport const useUsers = (options?: {\n  pagination?: Ref<Pagination>\n  sorting?: Ref<Sorting>\n  filters?: Ref<Partial<Filters>>\n}) => {\n  const isLoading = ref(false)\n  const users = ref<User[]>([])\n\n  const { filters = makeFiltersRef(), sorting = makeSortingRef(), pagination = makePaginationRef() } = options || {}\n\n  const fetch = async () => {\n    isLoading.value = true\n    const { data, pagination: newPagination } = await getUsers({\n      ...unref(filters),\n      ...unref(sorting),\n      ...unref(pagination),\n    })\n    users.value = data\n\n    ignoreUpdates(() => {\n      pagination.value = newPagination\n    })\n\n    isLoading.value = false\n  }\n\n  const { ignoreUpdates } = watchIgnorable([pagination, sorting], fetch, { deep: true })\n\n  watch(\n    filters,\n    () => {\n      // Reset pagination to first page when filters changed\n      pagination.value.page = 1\n      fetch()\n    },\n    { deep: true },\n  )\n\n  fetch()\n\n  return {\n    isLoading,\n\n    filters,\n    sorting,\n    pagination,\n\n    users,\n\n    fetch,\n\n    async add(user: User) {\n      isLoading.value = true\n      await addUser(user)\n      await fetch()\n      isLoading.value = false\n    },\n\n    async update(user: User) {\n      isLoading.value = true\n      await updateUser(user)\n      await fetch()\n      isLoading.value = false\n    },\n\n    async remove(user: User) {\n      isLoading.value = true\n      await removeUser(user)\n      await fetch()\n      isLoading.value = false\n    },\n  }\n}\n"],"names":["makePaginationRef","ref","makeSortingRef","makeFiltersRef","useUsers","options","isLoading","users","filters","sorting","pagination","fetch","data","newPagination","getUsers","unref","ignoreUpdates","watchIgnorable","watch","user","addUser","updateUser","removeUser"],"mappings":"4IAKA,MAAMA,EAAoB,IAAMC,EAAgB,CAAE,KAAM,EAAG,QAAS,GAAI,MAAO,CAAA,CAAG,EAC5EC,EAAiB,IAAMD,EAAa,CAAE,OAAQ,WAAY,aAAc,KAAM,EAC9EE,EAAiB,IAAMF,EAAsB,CAAE,SAAU,GAAM,OAAQ,GAAI,EAEpEG,EAAYC,GAInB,CACE,MAAAC,EAAYL,EAAI,EAAK,EACrBM,EAAQN,EAAY,CAAA,CAAE,EAEtB,CAAE,QAAAO,EAAUL,EAAe,EAAG,QAAAM,EAAUP,IAAkB,WAAAQ,EAAaV,EAAkB,GAAMK,GAAW,CAAA,EAE1GM,EAAQ,SAAY,CACxBL,EAAU,MAAQ,GAClB,KAAM,CAAE,KAAAM,EAAM,WAAYC,CAAc,EAAI,MAAMC,EAAS,CACzD,GAAGC,EAAMP,CAAO,EAChB,GAAGO,EAAMN,CAAO,EAChB,GAAGM,EAAML,CAAU,CAAA,CACpB,EACDH,EAAM,MAAQK,EAEdI,EAAc,IAAM,CAClBN,EAAW,MAAQG,CAAA,CACpB,EAEDP,EAAU,MAAQ,EAAA,EAGd,CAAE,cAAAU,CAAA,EAAkBC,EAAe,CAACP,EAAYD,CAAO,EAAGE,EAAO,CAAE,KAAM,EAAM,CAAA,EAErF,OAAAO,EACEV,EACA,IAAM,CAEJE,EAAW,MAAM,KAAO,EAClBC,GACR,EACA,CAAE,KAAM,EAAK,CAAA,EAGTA,IAEC,CACL,UAAAL,EAEA,QAAAE,EACA,QAAAC,EACA,WAAAC,EAEA,MAAAH,EAEA,MAAAI,EAEA,MAAM,IAAIQ,EAAY,CACpBb,EAAU,MAAQ,GAClB,MAAMc,EAAQD,CAAI,EAClB,MAAMR,EAAM,EACZL,EAAU,MAAQ,EACpB,EAEA,MAAM,OAAOa,EAAY,CACvBb,EAAU,MAAQ,GAClB,MAAMe,EAAWF,CAAI,EACrB,MAAMR,EAAM,EACZL,EAAU,MAAQ,EACpB,EAEA,MAAM,OAAOa,EAAY,CACvBb,EAAU,MAAQ,GAClB,MAAMgB,EAAWH,CAAI,EACrB,MAAMR,EAAM,EACZL,EAAU,MAAQ,EACpB,CAAA,CAEJ"}